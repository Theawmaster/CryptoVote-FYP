import sys, os
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'backend')))

from services.blind_signature_utils import unblind_signature, verify_signed_token, load_public_key

# === Token and Signature (Example Only) ===
original_token = "voteforA123"
signed_blinded_hex = "5a84009410f1081729fd482e63773a954de5fcca64c975cadad564711410a7cc4a791a79cc84010da9ce33bed35e27af3410b79d7f1955224e2fe0743a31ea3619e39da497ace6866969d049666945a70593da4e23dbfd4cd782bf6ff6c5b4b46afc524a1e4cb2c977fc21fa1ae14283fd28524a7bffe2aeea662787d299ae233969c6a5bf8dfce4fbfbb5d35a90e8fc5bc2dbd52a590079df8ff6cf0ae851bdd55acebfe04d8cf60836b2ad14168346ac69e5e0c02e63d80d46befbe21bea8fc64d187338e4ea32e62feafb4e003aad6e1415c2738730a676b6c14ac370fb5c005d9dedf11894f010b3ad8f7c37c38172bbbb5724ba7e95174eed811cf83286"  # replace with actual hex
signed_blinded_int = int(signed_blinded_hex, 16)

# r from simulate_blind.py output
r = 7204435744853162799222783284854889266561276604418569935461447225725463666427625588583127648823731648033459592368611727649025818034070330995819402294883863312742570377793641976597339994571530554046753218003197980965788129894426163532107646428441387790051743831253884897324274487511283282397304466501531891075980764246349771036461104091598892265275169590971566026845222108837112669604534278905792336918415346146319942667972667047790417769738123097183115083907896525091133139522325712650979673254070990514006386066303423974333115417759173346791599600510104569931654139359911302345089413242525635685126961799509024135743

# === Unblind and Verify ===
signature_int = unblind_signature(signed_blinded_int, r)
signature_hex = hex(signature_int)[2:]

pubkey = load_public_key()
is_valid = verify_signed_token(pubkey, original_token.encode(), signature_int)

print(f"ðŸ§© Final signature (hex): {signature_hex}")
print(f"âœ… Signature valid? {is_valid}")
