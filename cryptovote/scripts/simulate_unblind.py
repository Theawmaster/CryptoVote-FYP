import sys, os
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'backend')))

from utilities.blind_signature_utils import unblind_signature, verify_signed_token, load_public_key

# === Token and Signature (Example Only) ===
original_token = "voteforA123"
signed_blinded_hex = "a1306432716c207b2ba15fb0a8afd23afd10c7c801c660361d488ba6f62400094b4aa1f86e2ef7d0e61d8963f17da5c6b4ae4d3ee4d62f1f1e73d484a6856686617cc52d511c5824d59370c193f49b4d88cfd8cd665cbbce6240c4eb3fcb970ab2ff4b46666a4206974939a5d7996de464ade1864f4fc35f3fd12e017a3f245ef6051c1c5754016585d410c32fe6aee4abebbaaaa858e224030d54e9d725aa70422f5cabb4475a75d4cd7ae9f4fdcd85589736ee5d806e63795abdbfb0047ddb1f4a21e7e540c4e28151dc57fbaa6183955705d0af95d275d32aeabb8c635c8d09d29af6084685587eeb7f2b532eb1e55e8ac3365116a506d4714d0e72abcdd2"  # replace with actual hex
signed_blinded_int = int(signed_blinded_hex, 16)

# r from simulate_blind.py output
r = 21343769252285300520182563947025658642567678629635139357565951188550160172111589893773388730302352073608792092393738710681323900899031547456633855115407765326622746788147335742623149718000614604521385238016360634833214174594634223380800758568420181713701639798712703823427239673150198201309908237226655019754767245981241282046271192618941666835822990463946796946358412657813172232338504884703016754454813528216557103146026105109939901878834480072314805210745562290602102738669542377960013276312137140902502522218224839054750767275066179241487664125087624728785571947842628205005585603678398447891447077247769769918103

# === Unblind and Verify ===
signature_int = unblind_signature(signed_blinded_int, r)
signature_hex = hex(signature_int)[2:]

pubkey = load_public_key()
is_valid = verify_signed_token(pubkey, original_token.encode(), signature_int)

print(f"ðŸ§© Final signature (hex): {signature_hex}")
print(f"âœ… Signature valid? {is_valid}")
