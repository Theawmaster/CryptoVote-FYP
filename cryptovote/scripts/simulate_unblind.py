import sys, os
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'backend')))

from utilities.blind_signature_utils import unblind_signature, verify_signed_token, load_public_key

# === Token and Signature (Example Only) ===
original_token = "voteforA123"
signed_blinded_hex = "4ea3d6828f3fbbad4f133a471b1d7f433bb455f8f3425173ca34ce46edb7a059b11e0bbd4231cb24b2de73edb56cfde42a7126eb614ba42fdf16dfe2f1cca635b583b4a3f8a0ea838e8a992cf4acf4f5d5c882ab755e28b8ab66653a8e105979c3bdc9482e03eb55b85f15bb8043c6310724f9ae9995889e26d9eefbf2e7e567e791ad72771da58aa1decf665b3e2ebbea744d3ec047676acccb280049feb2df3492a02ec0f523ffd0bdc197c4597a62da3d32d2e401bacf9513cad095c0a9f868a21c7365e8a4632c7b27910a28e7f1f5e25bb2f262e1ad50562785cabf2105d055825ed4378ede704ef1b22eadc3ac77e546317bc1952805ae442f9b3a22e4"  # replace with actual hex
signed_blinded_int = int(signed_blinded_hex, 16)

# r from simulate_blind.py output
r = 9328699697838078853738723340485332746395269789192074240147478681282509815207365067626506373463613758817871062138681459587243858779289550054613252795877524085734709332574389332370072834284231941939661891720746289633135419717580077955347808042098212520993220630916229183509694282543945689712096963233776379934406729808848562381843223325005842260489443634959200678049697049764636339134105465576550908406941283430482951619297712031026119050177556215025971026091161802400600609884600358857584388008663698578592889509863766109468948698601261141322197619837260301132004322187469938632749608721632951165224238097847555522013

# === Unblind and Verify ===
signature_int = unblind_signature(signed_blinded_int, r)
signature_hex = hex(signature_int)[2:]

pubkey = load_public_key()
is_valid = verify_signed_token(pubkey, original_token.encode(), signature_int)

print(f"ðŸ§© Final signature (hex): {signature_hex}")
print(f"âœ… Signature valid? {is_valid}")
