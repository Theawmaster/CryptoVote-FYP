import sys, os
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'backend')))

from utilities.blind_signature_utils import unblind_signature, verify_signed_token, load_public_key

# === Token and Signature (Example Only) ===
original_token = "voteforA123"
signed_blinded_hex = "37ff6969081a2eff3eb741bf78464452f080787ba3781ab2943c2800f15038e4fe7a41f2ea78a76a1e2907ce197205ae0e2aae94425c02ee848e7f6e494338cb2344354b77ccc77de290c74867882bd012ec6d2f0c5d8bb497e62eec33bd18f3309081dfbb989c1e4fa5e4b69bd1035d07db6314ed41af3cbf308fc9b7d104484b7da8cc9dbacc3b6490f3694d1c68d21a39dce019e52d284d44c76db90013126fa4b4ee95db13c703d891670d6913f5716633a1791f0a3fce55ffe273027938f69243242244aff5d6526c5ec02008c41f5a0f1e3d4d47baf7e886740f4666bc044a7b33df15680be60eea728fbfbc952247f5ace29803f600e666a378dcd6be"  # replace with actual hex
signed_blinded_int = int(signed_blinded_hex, 16)

# r from simulate_blind.py output
r = 21050176427578929017168078734643825666604426959707926518638781932919703120363558678716582966339485224252174299178899666646639070036260032467895247511928669680005533549649386341487341446506546856565133962790340074144948077554191783345659843059807019425739274434119758190576729687533451933825116247156680549027723957224404282218604471843542973793604131268276892862862561261882328003917295120675704366030773532747594709915851897329810589296545290414380881452615326001962165407854982964095466970956057800410310327919386624031964404729440425971218006878781442501242415018804035320913833585016279203341890989196395364200733

# === Unblind and Verify ===
signature_int = unblind_signature(signed_blinded_int, r)
signature_hex = hex(signature_int)[2:]

pubkey = load_public_key()
is_valid = verify_signed_token(pubkey, original_token.encode(), signature_int)

print(f"ðŸ§© Final signature (hex): {signature_hex}")
print(f"âœ… Signature valid? {is_valid}")
